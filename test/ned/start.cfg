-- vim:set ft=lua: -*- Mode: lua -*-

local t = require("rom/test_env")
local L4 = require("L4")

local dummy_cap1 = L4.Env.factory:create(L4.Proto.Factory)
local dummy_cap2 = L4.Env.factory:create(L4.Proto.Factory)

L4.default_loader:start(
  {
    caps = {
      test_w = L4.default_loader:create_namespace({}):m("rw"),
      test_no_w = L4.default_loader:create_namespace({}),
      test_s = L4.Env.user_factory:create(L4.Proto.Factory, 20000):m("rs"),
      test_no_s = L4.Env.user_factory:create(L4.Proto.Factory, 20000),
      test_d = L4.Env.factory:create(L4.Proto.Factory):m("rd"),
      test_no_d = L4.Env.factory:create(L4.Proto.Factory),
      dummy_cap1 = dummy_cap1,
      dummy_cap2 = dummy_cap2,
      test_namespace = {name1 = dummy_cap1, name2 = dummy_cap2, name_ph = "ph"}
    },
    log = {"test_start_log_tag", "red"}
  },
  "rom/"..t.TEST_PROG..' arg1 arg2 -arg3',
  { ENV_VAR1 = "env_var1", ENV_VAR2 = "env_var2"}
)
